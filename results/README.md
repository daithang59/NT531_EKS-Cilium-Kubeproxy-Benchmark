# results/ — Kết quả benchmark (Results Contract)

Thư mục này chứa **toàn bộ artifacts** sinh ra từ các lần chạy benchmark.
Mọi script **phải** tạo output đúng cấu trúc dưới đây; người chạy (Runner) và
người kiểm tra (Checker) dùng `checklist.txt` để xác nhận run hợp lệ.

---

## Cấu trúc thư mục (bắt buộc)

Mỗi run tạo **một** thư mục con theo convention:

```
results/
  mode=<A_kube-proxy|B_cilium-ebpfkpr>/
    scenario=<S1|S2|S3>/
      load=<L1|L2|L3>/
        run=<R#_YYYY-MM-DDTHH-mm-ss+07-00>/
          bench.log
          metadata.json
          checklist.txt
          kubectl_get_all.txt
          kubectl_top_nodes.txt
          events.txt
          (optional) cilium_status.txt      # Mode B hoặc S3
          (optional) hubble_status.txt      # Mode B hoặc S3
          (optional) hubble_flows.jsonl     # Mode B hoặc S3
```

### Naming key

| Token | Giá trị hợp lệ | Ví dụ |
|-------|----------------|-------|
| `mode` | `A_kube-proxy`, `B_cilium-ebpfkpr` | `mode=A_kube-proxy` |
| `scenario` | `S1`, `S2`, `S3` | `scenario=S1` |
| `load` | `L1`, `L2`, `L3` | `load=L2` |
| `run` | `R<n>_<ISO-like timestamp +07:00>` | `run=R1_2026-02-27T14-30-00+07-00` |

> Timestamp luôn dùng **+07:00** (Asia/Ho\_Chi\_Minh), thay `:` bằng `-` trong
> tên thư mục để tương thích Windows/Linux.

---

## Giải thích file artifact

| File | Bắt buộc? | Nội dung |
|------|-----------|----------|
| `bench.log` | **Có** | Raw stdout của `fortio load`. Chứa latency percentiles (p50/p90/p95/p99), RPS, error count. |
| `metadata.json` | **Có** | JSON theo template `results/metadata.template.json.txt`. Chứa mode, scenario, load params, cluster info, timestamps. |
| `checklist.txt` | **Có** | Tick-box kiểm tra cho Runner/Checker (xem mẫu bên dưới). |
| `kubectl_get_all.txt` | **Có** | `kubectl get all -A` snapshot tại thời điểm đo. |
| `kubectl_top_nodes.txt` | **Có** | `kubectl top nodes` (hoặc ghi "metrics-server not available"). |
| `events.txt` | **Có** | `kubectl get events -A --sort-by=.metadata.creationTimestamp`. |
| `cilium_status.txt` | Tùy chọn | `cilium status` (bắt buộc nếu Mode B hoặc S3). |
| `hubble_status.txt` | Tùy chọn | `hubble status` (bắt buộc nếu Mode B hoặc S3). |
| `hubble_flows.jsonl` | Tùy chọn | `hubble observe -o jsonpb` (bắt buộc nếu Mode B hoặc S3). |

---

## Mẫu `checklist.txt`

```
# Run Checklist — auto-generated by scripts
# Runner / Checker: đánh [x] để xác nhận

## Pre-run
- [ ] kubectl context active and correct cluster
- [ ] All nodes Ready (kubectl get nodes)
- [ ] Workload pods Running (echo + fortio in namespace netperf)
- [ ] Service reachable from fortio pod

## Configuration
- [ ] MODE matches expected (A or B)
- [ ] SCENARIO matches expected (S1, S2, or S3)
- [ ] LOAD matches expected (L1, L2, or L3)
- [ ] REPEAT number is correct

## Stability
- [ ] No pod restarts during run
- [ ] No node NotReady events during run
- [ ] No OOM kills during run

## Artifacts present
- [ ] bench.log exists and non-empty
- [ ] metadata.json exists and valid JSON
- [ ] kubectl_get_all.txt exists
- [ ] kubectl_top_nodes.txt exists
- [ ] events.txt exists
- [ ] (Mode B / S3) cilium_status.txt exists
- [ ] (Mode B / S3) hubble_status.txt exists
- [ ] (Mode B / S3) hubble_flows.jsonl exists

## Post-run
- [ ] No anomalies noted (or documented in metadata.json → results.anomalies)
```

---

## Lưu ý

- Thư mục `results/` nằm trong `.gitignore` (trừ README và template).
  → Không commit raw data lên git. Dùng Git LFS hoặc upload riêng nếu cần chia sẻ.
- Naming convention `key=value` trong tên thư mục giúp dễ parse bằng script/Python.
- Mỗi `(mode × scenario × load × run)` là một **đơn vị đo lường độc lập** (independent trial).
- Scripts (`run_s1.sh`, `run_s2.sh`, `run_s3.sh`) tự động tạo đúng cấu trúc khi được gọi
  với env vars `MODE`, `SCENARIO`, `LOAD`, `REPEAT`.
